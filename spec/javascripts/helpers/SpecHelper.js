(function() {
  if(typeof window == 'undefined') {
    // Get Node.js caught up to speed

    var jsdom = require('jsdom');
    window = jsdom.jsdom("<html><head></head><body></body></html>").createWindow();
    global.navigator = {
      userAgent: 'jasmine'
    };
    global.window = window;
    global.document = window.document;
    global.location = { href: "http://monitoring" };
    global.document.location = global.location;
    
    var fs = require('fs');
    var path = require('path');
    var yaml = require('yaml');

    var yamlSource = fs.readFileSync(path.resolve(__dirname, '../support/jasmine.yml'));
    var jasmineConfig = yaml.eval(yamlSource.toString());
    jasmineConfig.src_files.forEach(function(lib) {
      require(lib.replace(/^src\//,'').replace(/\.[^\.]+$/, ''));
    });

    if (window.$) { 
      global.$ = window.$; 
      global.jQuery = window.jQuery;
    }
  }
})();

beforeEach(function() {
  this.addMatchers({
    toBeInstanceOf: function(klass) {
      return typeof this.actual == klass;
    }
  });
  Careplane.currentExtension = new TestExtension(window.document);
  Careplane.fetch = TestExtension.fetch;
  HallOfFame.clear();
});

jasmine.exampleGroups = {};

jasmine.Env.prototype.itBehavesLikeA = function(subject) {
  var group = jasmine.exampleGroups[subject];
  if(group) {
    group.call(this);
  } else {
    jasmine.log('Missing example group "' + subject + '"');
  }
}

jasmine.Env.prototype.sharedExamplesFor = function(subject, suite) {
  jasmine.exampleGroups[subject] = suite;
}

itBehavesLikeA = function(subject) {
  return jasmine.getEnv().itBehavesLikeA(subject);
}
itBehavesLikeAn = itBehavesLikeA;

sharedExamplesFor = function(subject, suite) {
  return jasmine.getEnv().sharedExamplesFor(subject, suite);
}

kayakFlightDetails = " <div class=\"inlinedetailswrapper\">    <div class=\"inlinedetailsclose\"></div>                                 <div class=\"linkbutton\"        onclick=\"flightprint(434,'629c2bfc56417cf8e52d53d524ac81d7');addAdt('details/print');return false\" id=''    title=\"\"><div>print     <img src=\"/images/v394170/icons/a-result-button-arrow-right.png\" width='6' height='6'/> </div></div>                            <div id=\"addFlightToTrip434\" class=\"addFlightToTrip\">                                <div style=\"display: none;\">                                                 <div class=\"linkbutton\"        onclick=\"addAdt('details/addtotrips');addResultToTrip('APMeVXT', '629c2bfc56417cf8e52d53d524ac81d7', 'addFlightToTrip434');return false\" id='lnkAddToTrip434'    title=\"\"><div>add to My Trips     <img src=\"/images/v394170/icons/a-result-button-arrow-right.png\" width='6' height='6'/> </div></div>                                </div>                                                                                     <div class=\"linkbutton\"        onclick=\"addAdt('details/addtotrips/anon'); showTripsAjaxReg('#lnkAddToTrip434');return false\" id=''    title=\"\"><div>add to My Trips     <img src=\"/images/v394170/icons/a-result-button-arrow-right.png\" width='6' height='6'/> </div></div>                            </div>                        <div class=\"clear\"></div>                <div class=\"inlinedetailstabs\" style=\"margin-top: 9px;\">        <ul>            <li><a href=\"#inlineflightitinerary434\">Details</a></li>            <li><a href=\"#inlineflightfares434\">Fares</a></li>        </ul>                <div class=\"inlineflightitinerary\" id=\"inlineflightitinerary434\">                                    <div class=\"inlineflightitinerarycabins\">                                    <a data-cabin=\"Economy\" href=\"#\">                        <b>Economy</b>                        <span>$364</span>                    </a>                                    <a data-cabin=\"First\" href=\"#\">                        <b>First</b>                        <span>$909</span>                    </a>                                <div class=\"clear\"></div>            </div>                                        <table class=\"inlineflightitinerarylegs\">                    <colgroup>                        <col class=\"icon\" />                        <col class=\"od\" />                        <col class=\"time\" />                        <col class=\"airportCode\" />                        <col class=\"airportName\" />                        <col class=\"duration\" />                    </colgroup>                                        <tbody>                                                                                <tr class=\"header\">                                <td style=\"font-weight: bold;\">                                                                            Depart                                                                    </td>                                <td colspan=\"2\" style=\"font-weight: bold;\">Mon, Jul 4</td>                                <td colspan=\"2\"><b>DTW</b> to <b>SFO</b> &ndash; nonstop</td>                                <td class=\"duration\">5h 16m</td>                            </tr>                                                                                                                                                                                                                                                                                                                                                                                                                        <tr class=\"first\">                                    <td class=\"icon\">                                                                                    <img src='/images/v394128/air/DL.gif' />                                                                            </td>                                                <td colspan=\"4\">                                        Delta &ndash;                                                                                    Flight 745                                                                                                                                </td>                                                                        <td class=\"duration\">                                        5h 16m                                    </td>                                </tr>                                                                <tr>                                    <td>&nbsp;</td>                                                                        <td class=\"direction\">Take-off</td>                                                                        <td class=\"time\">Mon 9:00a</td>                                                                        <td class=\"airportCode\">DTW</td>                                                                        <td colspan=\"2\">Detroit, MI</td>                                </tr>                                                                <tr>                                    <td>&nbsp;</td>                                                                        <td class=\"direction\">Landing</td>                                                                        <td class=\"time\">Mon 11:16a</td>                                                                        <td class=\"airportCode\">SFO</td>                                                                        <td colspan=\"2\">San Francisco, CA</td>                                </tr>                                                                <tr>                                    <td>&nbsp;</td>                                                                        <td class=\"extra\" colspan=\"5\">                                                                                    <select class=\"extraCabins\">                                                                                                    <option value=\"Economy\">Economy</option>                                                                                                    <option value=\"First\">First</option>                                                                                            </select>                                            &nbsp;|&nbsp;                                                                                                                                                                                                            Boeing 757 (Narrow-body Jet)                                                                                                                            &nbsp;|&nbsp;5h 16m                                                                                                                                                                        &nbsp;|&nbsp;80% on time                                                                                                                            &nbsp;|&nbsp;2073 miles                                                                                                                            &nbsp;|&nbsp;<span class=\"qImg wifi\">WiFi Available</span>                                                                                                                                                                                                                                                        <span class=\"extraCabin\" data-cabin=\"Economy\">                                                                                                            &nbsp;|&nbsp;Fare code: TE07A0SG                                                                                                                                                                &nbsp;|&nbsp;1 seats remain                                                                                                    </span>                                                                                            <span class=\"extraCabin hidden\" data-cabin=\"First\">                                                                                                            &nbsp;|&nbsp;Fare code: HE07A0QA/WNUP                                                                                                                                                                &nbsp;|&nbsp;9+ seats remain                                                                                                    </span>                                                                                                                        </td>                                </tr>                                                                                                                                                                            <tr class=\"header\">                                <td style=\"font-weight: bold;\">                                                                            Return                                                                    </td>                                <td colspan=\"2\" style=\"font-weight: bold;\">Mon, Jul 11</td>                                <td colspan=\"2\"><b>SFO</b> to <b>DTW</b> &ndash; nonstop</td>                                <td class=\"duration\">4h 30m</td>                            </tr>                                                                                                                                                                                                                                                                <tr class=\"highlight\">                                    <td colspan=\"6\">                                        <div>                                                                                                                                    This flight leaves on <b>Monday</b> and arrives on <b>Tuesday</b>.                                        </div>                                    </td>                                </tr>                                                                                                                                                                                                                                                    <tr class=\"first\">                                    <td class=\"icon\">                                                                                    <img src='/images/v394128/air/DL.gif' />                                                                            </td>                                                <td colspan=\"4\">                                        Delta &ndash;                                                                                    Flight 1988                                                                                                                                </td>                                                                        <td class=\"duration\">                                        4h 30m                                    </td>                                </tr>                                                                <tr>                                    <td>&nbsp;</td>                                                                        <td class=\"direction\">Take-off</td>                                                                        <td class=\"time overnight\">Mon 11:00p</td>                                                                        <td class=\"airportCode\">SFO</td>                                                                        <td colspan=\"2\">San Francisco, CA</td>                                </tr>                                                                <tr>                                    <td>&nbsp;</td>                                                                        <td class=\"direction\">Landing</td>                                                                        <td class=\"time overnight\">Tue 6:30a</td>                                                                        <td class=\"airportCode\">DTW</td>                                                                        <td colspan=\"2\">Detroit, MI</td>                                </tr>                                                                <tr>                                    <td>&nbsp;</td>                                                                        <td class=\"extra\" colspan=\"5\">                                                                                    <select class=\"extraCabins\">                                                                                                    <option value=\"Economy\">Economy</option>                                                                                                    <option value=\"First\">First</option>                                                                                            </select>                                            &nbsp;|&nbsp;                                                                                                                                                                                                            Boeing 757 (Narrow-body Jet)                                                                                                                            &nbsp;|&nbsp;4h 30m                                                                                                                                                                        &nbsp;|&nbsp;<span class=\"mildwarn\">60% on time </span>                                                                                                                            &nbsp;|&nbsp;2073 miles                                                                                                                            &nbsp;|&nbsp;<span class=\"qImg wifi\">WiFi Available</span>                                                                                                                                                                                                                                                        <span class=\"extraCabin\" data-cabin=\"Economy\">                                                                                                            &nbsp;|&nbsp;Fare code: UE10A0SJ                                                                                                                                                                &nbsp;|&nbsp;8 seats remain                                                                                                    </span>                                                                                            <span class=\"extraCabin hidden\" data-cabin=\"First\">                                                                                                            &nbsp;|&nbsp;Fare code: HE07A0QA/WNUP                                                                                                                                                                &nbsp;|&nbsp;9+ seats remain                                                                                                    </span>                                                                                                                        </td>                                </tr>                                                                                                                                        </tbody>                </table>                    </div>                <ul id=\"inlineflightfares434\" class=\"inlineflightfares\">                            <li class=\"expanded\" data-cabin=\"Economy\">                    <div><span>Economy</span> &ndash; $364</div>                    <div class=\"cmp2Block\">                        <div class=\"provider header\">                            <div class=\"pname\">Booking site</div>                            <div class=\"price\">Cost per ticket</div>                            <div class=\"total price\">Total</div>                        </div>                                                                            <div class=\"provider\">                                <div class=\"pname\">                                    <img src=\"/images/v394132/booking/smaller/DL.gif\" />                                                                            Delta&nbsp;&nbsp;                                                                    </div>                                                                                                            <div class=\"price\">$364.40</div>                                        <div class=\"total price\"><a target=\"bookit434DL\" title=\"Book at delta.com\" href=\"/book/flight?code=-1916408200.APMeVXT.0.F.DL,ITA.36440.629c2bfc56417cf8e52d53d524ac81d7&sub=E7e4af79a0d&resultid=629c2bfc56417cf8e52d53d524ac81d7\" onclick=\"javascript: itemClicked('434', 'Welcome back from delta.com&hellip;', '', 'details/resultclick/price');\">$364.40</a></div>                                                                        <div class=\"go\">                                                                                    <button class=\"ui-button ui-button-small\"  onclick=\"window.open('/book/flight?code=-1916408200.APMeVXT.0.F.DL,ITA.36440.629c2bfc56417cf8e52d53d524ac81d7&sub=E7e4af79a0d&resultid=629c2bfc56417cf8e52d53d524ac81d7', 'bookit434DL');itemClicked('434', 'Welcome back from delta.com&hellip;', '', 'details/resultclick/button');\" ><span>Select</span></button>                                                                            </div>                                                            </div>                                             </div>                                             <div class=\"clear\"></div>                </li>                             <li data-cabin=\"First\">                    <div><span>First</span> &ndash; $909</div>                    <div>                        <div class=\"provider header\">                            <div class=\"pname\">Booking site</div>                            <div class=\"price\">Cost per ticket</div>                            <div class=\"total price\">Total</div>                        </div>                                                                            <div class=\"provider\">                                <div class=\"pname\">                                    <img src=\"/images/v394132/booking/smaller/DL.gif\" />                                                                            Delta&nbsp;&nbsp;                                                                    </div>                                                                                                            <div class=\"price\">$909.40</div>                                        <div class=\"total price\"><a target=\"bookit434DL\" title=\"Book at delta.com\" href=\"/book/flight?code=-1916408200.APMeVXT.0.F.DL,ITA.90940.629c2bfc56417cf8e52d53d524ac81d7&sub=F7e4af79a0d&resultid=629c2bfc56417cf8e52d53d524ac81d7\" onclick=\"javascript: itemClicked('434', 'Welcome back from delta.com&hellip;', '', 'details/resultclick/price');\">$909.40</a></div>                                                                        <div class=\"go\">                                                                                    <button class=\"ui-button ui-button-small\"  onclick=\"window.open('/book/flight?code=-1916408200.APMeVXT.0.F.DL,ITA.90940.629c2bfc56417cf8e52d53d524ac81d7&sub=F7e4af79a0d&resultid=629c2bfc56417cf8e52d53d524ac81d7', 'bookit434DL');itemClicked('434', 'Welcome back from delta.com&hellip;', '', 'details/resultclick/button');\" ><span>Select</span></button>                                                                            </div>                                                            </div>                                             </div>                                             <div class=\"clear\"></div>                </li>                     </ul>    </div>            </div>";
