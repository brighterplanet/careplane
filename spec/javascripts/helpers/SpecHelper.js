(function() {
  if(typeof require != 'undefined') {
    // Get Node.js caught up to speed

    var jsdom = require('jsdom');
    window = jsdom.jsdom("<html><head></head><body></body></html>").createWindow();
    global.navigator = {
      userAgent: 'jasmine'
    };
    global.window = window;
    global.document = window.document;
    global.location = { href: "http://monitoring" };
    global.document.location = global.location;
    
    var fs = require('fs');
    var path = require('path');
    var yaml = require('yaml');

    var yamlSource = fs.readFileSync(path.resolve(__dirname, '../support/jasmine.yml'));
    var jasmineConfig = yaml.eval(yamlSource.toString());
    jasmineConfig.src_files.forEach(function(lib) {
      require(lib.replace(/^src\//,'').replace(/\.[^\.]+$/, ''));
    });

    if (window.$) { 
      global.$ = window.$; 
      global.jQuery = window.jQuery;
    }
  } else {
    require = function() { };
  }
})();

beforeEach(function() {
  this.addMatchers({
    toBeInstanceOf: function(klass) {
      return typeof this.actual == klass;
    }
  });
  Careplane.currentExtension = new TestExtension(window.document);
  Careplane.fetch = TestExtension.fetch;
  HallOfFame.clear();
});

jasmine.exampleGroups = {};

jasmine.Env.prototype.itBehavesLikeA = function(subject) {
  var group = jasmine.exampleGroups[subject];
  if(group) {
    group.call(this);
  } else {
    jasmine.log('Missing example group "' + subject + '"');
  }
}

jasmine.Env.prototype.sharedExamplesFor = function(subject, suite) {
  jasmine.exampleGroups[subject] = suite;
}

itBehavesLikeA = function(subject) {
  return jasmine.getEnv().itBehavesLikeA(subject);
}
itBehavesLikeAn = itBehavesLikeA;

sharedExamplesFor = function(subject, suite) {
  return jasmine.getEnv().sharedExamplesFor(subject, suite);
}

kayakFlightDetails = "\n<div class=\"inlinedetailswrapper\">\n            <div>\n                            <div id=\"addFlightToTrip50\" class=\"addFlightToTrip\">\n                                        <div style=\"display: none;\">\n                                                         <div class=\"linkbutton\"\n        onclick=\"addAdt('details/addtotrips');addResultToTrip('JxhV5G', '9c843558485dc61b3eda74eadb102ca3', 'addFlightToTrip50');return false\" id='lnkAddToTrip50'\n    title=\"\"><div>add to My Trips     <img src=\"/images/v3750/icons/a-result-button-arrow-right.png\" width='6' height='6'/> </div></div>                                        </div>\n                                        \n                                                             <div class=\"linkbutton\"\n        onclick=\"addAdt('details/addtotrips/anon'); showTripsAjaxReg('#lnkAddToTrip50');return false\" id=''\n    title=\"\"><div>add to My Trips     <img src=\"/images/v3750/icons/a-result-button-arrow-right.png\" width='6' height='6'/> </div></div>                                    </div>\n                        \n                             <div class=\"linkbutton\"\n        onclick=\"flightprint(50,'9c843558485dc61b3eda74eadb102ca3');addAdt('details/print');return false\" id=''\n    title=\"\"><div>print     <img src=\"/images/v3750/icons/a-result-button-arrow-right.png\" width='6' height='6'/> </div></div>        </div>\n        <div class=\"clear\"></div>\n        \n    <div class=\"inlineflightdetails\" id=\"fdetailsdiv50\" style=\"margin-top: 6px;\">\n        <table class=\"flightdetailstable\">\n            <tr>\n                <td width=\"100%\">\n                                        <div class=\"detailPriceList\" id=\"detailPriceList50\">\n                        <ul>\n                                                            <li><a data-cabin=\"Economy\" href=\"#detailPriceList50Economy\">Economy</a></li>\n                                                    </ul>\n\n                                                    <div id=\"detailPriceList50Economy\" class=\"collapsibleSection\">\n                                <div class=\"collapsibleSectionContent cmp2Block\">\n                                    <div class=\"provider header\">\n                                        <div class=\"pname\">Booking site</div>\n                                        <div class=\"price\">Cost per Ticket</div>\n                                        <div class=\"total price\">Total</div>\n                                    </div>\n                                    \n                                                                            <div class=\"provider\" style=\"border-style: solid;\">\n                                            <div class=\"pname\">\n                                                <img src=\"/images/v37565/booking/smaller/ORBITZAIR.gif\" />\n                                                                                                    Orbitz&nbsp;&nbsp;\n                                                                                            </div>\n\n                                                                                                                                                <div class=\"price\">$414.80</div>\n                                                    <div class=\"total price\"><a target=\"bookit50ORBITZAIR\" title=\"Book at orbitz.com\" href=\"/book/flight?code=-2035682652.JxhV5G.0.F.ORBITZAIR,ORBITZAIR.41480.9c843558485dc61b3eda74eadb102ca3&sub=1&resultid=9c843558485dc61b3eda74eadb102ca3\" onclick=\"javascript: itemClicked('50', 'Welcome back from {0}&hellip;', '', 'details/resultclick/price');\">$414.80</a></div>\n                                                \n                                                <div class=\"go\">\n                                                                                                            <button class=\"ui-button ui-button-small\"  onclick=\"window.open('/book/flight?code=-2035682652.JxhV5G.0.F.ORBITZAIR,ORBITZAIR.41480.9c843558485dc61b3eda74eadb102ca3&sub=1&resultid=9c843558485dc61b3eda74eadb102ca3', 'bookit50ORBITZAIR');itemClicked('50', 'Welcome back from {0}&hellip;', '', 'details/resultclick/button');\" ><span>Select</span></button>\n                                                                                                    </div>\n                                                                                    </div>                                                                             <div class=\"provider\">\n                                            <div class=\"pname\">\n                                                <img src=\"/images/v375162/booking/smaller/CHEAPTICKETS.gif\" />\n                                                                                                    CheapTickets.com&nbsp;&nbsp;\n                                                                                            </div>\n\n                                                                                                                                                <div class=\"price\">$414.80</div>\n                                                    <div class=\"total price\"><a target=\"bookit50CHEAPTICKETS\" title=\"Book at cheaptickets.com\" href=\"/book/flight?code=234843170.JxhV5G.0.F.CHEAPTICKETS,CHEAPTICKETS.41480.9c843558485dc61b3eda74eadb102ca3&sub=1&resultid=9c843558485dc61b3eda74eadb102ca3\" onclick=\"javascript: itemClicked('50', 'Welcome back from {0}&hellip;', '', 'details/resultclick/price');\">$414.80</a></div>\n                                                \n                                                <div class=\"go\">\n                                                                                                            <button class=\"ui-button ui-button-small\"  onclick=\"window.open('/book/flight?code=234843170.JxhV5G.0.F.CHEAPTICKETS,CHEAPTICKETS.41480.9c843558485dc61b3eda74eadb102ca3&sub=1&resultid=9c843558485dc61b3eda74eadb102ca3', 'bookit50CHEAPTICKETS');itemClicked('50', 'Welcome back from {0}&hellip;', '', 'details/resultclick/button');\" ><span>Select</span></button>\n                                                                                                    </div>\n                                                                                    </div>                                                                             <div class=\"provider\">\n                                            <div class=\"pname\">\n                                                <img src=\"/images/v375183/booking/smaller/FL.gif\" />\n                                                                                                    AirTran&nbsp;&nbsp;\n                                                                                            </div>\n\n                                                                                                                                                <div class=\"price\">$414.80</div>\n                                                    <div class=\"total price\"><a target=\"bookit50FL\" title=\"Book at airtran.com\" href=\"/book/flight?code=1521791408.JxhV5G.0.F.FL,ITA.41480.9c843558485dc61b3eda74eadb102ca3&sub=1&resultid=9c843558485dc61b3eda74eadb102ca3\" onclick=\"javascript: itemClicked('50', 'Welcome back from {0}&hellip;', '', 'details/resultclick/price');\">$414.80</a></div>\n                                                \n                                                <div class=\"go\">\n                                                                                                            <button class=\"ui-button ui-button-small\"  onclick=\"window.open('/book/flight?code=1521791408.JxhV5G.0.F.FL,ITA.41480.9c843558485dc61b3eda74eadb102ca3&sub=1&resultid=9c843558485dc61b3eda74eadb102ca3', 'bookit50FL');itemClicked('50', 'Welcome back from {0}&hellip;', '', 'details/resultclick/button');\" ><span>Select</span></button>\n                                                                                                    </div>\n                                                                                    </div>                                                                     </div>                                     \n                                <div class=\"clear\"></div>\n                            </div>                         \n                        <div class=\"clear\"></div>\n                    </div>\n                </td>\n            </tr>\n\n                            \n            <tr><td style=\"font-size: 12px\">&nbsp;</td></tr>\n        </table>\n    </div>\n\n            <div id=\"inlineFlightDetailsLegs50\">\n            <ul>\n                                    <li>\n                        <a href=\"#inlineFlightDetailsLeg50-1\">\n                                                            Departure                                                    </a>\n                    </li>\n                                    <li>\n                        <a href=\"#inlineFlightDetailsLeg50-2\">\n                                                            Return                                                    </a>\n                    </li>\n                            </ul>\n            \n                            \n                <div id=\"inlineFlightDetailsLeg50-1\" class=\"inlineFlightDetailsLeg\">\n                    <table>\n                        <colgroup>\n                            <col class=\"date\" />\n                            <col class=\"icon\" />\n                            <col class=\"od\" />\n                            <col class=\"time\" />\n                            <col class=\"airportCode\" />\n                            <col class=\"airportName\" />\n                            <col class=\"duration\" />\n                        </colgroup>\n                        \n                        <tbody>\n                                                        \n                            <tr class=\"header\">\n                                <td colspan=\"2\" style=\"font-weight: bold;\">Tue, May 10</td>\n                                <td colspan=\"4\">\n                                    <span style=\"float: right; margin-right: 6px;\">1 stop</span>\n                                    <b>Detroit</b> to <b>San Francisco</b>                                </td>\n                                <td class=\"duration\">9h 50m</td>\n                            </tr>\n                            \n                                                                                                                \n                                                        \n                                                                                                                            \n                                <tr class=\"first\">\n                                                                            <td rowspan=\"9\">\n                                                                                        \n                                                                                            <a class=\"shared\" data-leg=\"0\" href=\"#\">\n                                                                                                            <b>5 results</b><br/>share this flight                                                                                                        \n                                                                                                                                                                        <span>Select this departure</span>\n                                                                                                                                                            </a>\n                                                                                    </td>\n                                                                        \n                                    <td class=\"icon\">\n                                                                                    <img src='/images/v375101/air/FL.gif' />\n                                                                            </td>\n            \n                                    <td colspan=\"4\">\n                                        AirTran &mdash;\n                                                                                    Flight 143                                                    \n                                                                            </td>\n                                    \n                                    <td class=\"duration\">\n                                        1h 58m\n                                    </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Take-off</td>\n                                    \n                                    <td class=\"time\">Tue 6:00a</td>\n                                    \n                                    <td class=\"airportCode\">DTW</td>\n                                    \n                                    <td colspan=\"2\">Detroit Metro </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Landing</td>\n                                    \n                                    <td class=\"time\">Tue 7:58a</td>\n                                    \n                                    <td class=\"airportCode\">ATL</td>\n                                    \n                                    <td colspan=\"2\">Hartsfield-Jackson </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"extra\" colspan=\"5\">\n                                                                                \n                                                                                \n                                        <div>\n                                                                                            Coach\n                                                                                                    &nbsp;|&nbsp;Fare code: RZXC\n                                                                                                &nbsp;|&nbsp;\n                                                                                                                                        Boeing 717 (Narrow-body Jet)\n                                                                                                                                        &nbsp;|&nbsp;1h 58m\n                                                                                                                                                                                        &nbsp;|&nbsp;80% on time                                                                                                                                        &nbsp;|&nbsp;595 miles\n                                                                                                                                        &nbsp;|&nbsp;<span class=\"qImg wifi\">WiFi Available</span>\n                                                                                                                                        &nbsp;|&nbsp;7 seats remain                                                                                    </div>\n                                        \n                                                                            </td>\n                                </tr>\n                                \n                                                                    <tr class=\"layover\">\n                                        <td>&nbsp;</td>\n                                        \n                                        <td class=\"direction\">Layover</td>\n                                        \n                                        <td colspan=\"3\">&nbsp;</td>\n                                        \n                                        <td class=\"duration\">\n                                            <div>2h 27m</div>\n                                        </td>\n                                    </tr>\n                                                                                                                                                            \n                                <tr class=\"first\">\n                                                                        \n                                    <td class=\"icon\">\n                                                                                    <img src='/images/v375101/air/FL.gif' />\n                                                                            </td>\n            \n                                    <td colspan=\"4\">\n                                        AirTran &mdash;\n                                                                                    Flight 321                                                    \n                                                                            </td>\n                                    \n                                    <td class=\"duration\">\n                                        5h 25m\n                                    </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Take-off</td>\n                                    \n                                    <td class=\"time\">Tue 10:25a</td>\n                                    \n                                    <td class=\"airportCode\">ATL</td>\n                                    \n                                    <td colspan=\"2\">Hartsfield-Jackson </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Landing</td>\n                                    \n                                    <td class=\"time\">Tue 12:50p</td>\n                                    \n                                    <td class=\"airportCode\">SFO</td>\n                                    \n                                    <td colspan=\"2\">San Francisco</td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"extra\" colspan=\"5\">\n                                                                                \n                                                                                \n                                        <div>\n                                                                                            Coach\n                                                                                                    &nbsp;|&nbsp;Fare code: RZXC\n                                                                                                &nbsp;|&nbsp;\n                                                                                                                                        Boeing 737-700 (Narrow-body Jet)\n                                                                                                                                        &nbsp;|&nbsp;5h 25m\n                                                                                                                                                                                    &nbsp;|&nbsp;2134 miles\n                                                                                                                                        &nbsp;|&nbsp;<span class=\"qImg wifi\">WiFi Available</span>\n                                                                                                                                        &nbsp;|&nbsp;7 seats remain                                                                                    </div>\n                                        \n                                                                            </td>\n                                </tr>\n                                \n                                                                                    </tbody>\n                    </table>\n                </div>\n                            \n                <div id=\"inlineFlightDetailsLeg50-2\" class=\"inlineFlightDetailsLeg\">\n                    <table>\n                        <colgroup>\n                            <col class=\"date\" />\n                            <col class=\"icon\" />\n                            <col class=\"od\" />\n                            <col class=\"time\" />\n                            <col class=\"airportCode\" />\n                            <col class=\"airportName\" />\n                            <col class=\"duration\" />\n                        </colgroup>\n                        \n                        <tbody>\n                                                        \n                            <tr class=\"header\">\n                                <td colspan=\"2\" style=\"font-weight: bold;\">Thu, May 12</td>\n                                <td colspan=\"4\">\n                                    <span style=\"float: right; margin-right: 6px;\">1 stop</span>\n                                    <b>San Francisco</b> to <b>Detroit</b>                                </td>\n                                <td class=\"duration\">9h 00m</td>\n                            </tr>\n                            \n                                                                                                                \n                                                            <tr class=\"highlight\">\n                                    <td colspan=\"7\">\n                                                                                                                        This flight leaves on <b>Thursday</b> and arrives on <b>Friday</b>.                                    </td>\n                                </tr>\n                                                        \n                                                                                                                                                            \n                                <tr class=\"first\">\n                                                                            <td rowspan=\"9\">\n                                                                                        \n                                                                                            <a class=\"shared\" data-leg=\"1\" href=\"#\">\n                                                                                                            <b>5 results</b><br/>share this flight                                                                                                        \n                                                                                                                                                                        <span>Select this return</span>\n                                                                                                                                                            </a>\n                                                                                    </td>\n                                                                        \n                                    <td class=\"icon\">\n                                                                                    <img src='/images/v375101/air/FL.gif' />\n                                                                            </td>\n            \n                                    <td colspan=\"4\">\n                                        AirTran &mdash;\n                                                                                    Flight 328                                                    \n                                                                            </td>\n                                    \n                                    <td class=\"duration\">\n                                        4h 45m\n                                    </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Take-off</td>\n                                    \n                                    <td class=\"time overnight\">Thu 10:59p</td>\n                                    \n                                    <td class=\"airportCode\">SFO</td>\n                                    \n                                    <td colspan=\"2\">San Francisco</td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Landing</td>\n                                    \n                                    <td class=\"time overnight\">Fri 6:44a</td>\n                                    \n                                    <td class=\"airportCode\">ATL</td>\n                                    \n                                    <td colspan=\"2\">Hartsfield-Jackson </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"extra\" colspan=\"5\">\n                                                                                \n                                                                                \n                                        <div>\n                                                                                            Coach\n                                                                                                    &nbsp;|&nbsp;Fare code: H7ZXC\n                                                                                                &nbsp;|&nbsp;\n                                                                                                                                        Boeing 737-700 (Narrow-body Jet)\n                                                                                                                                        &nbsp;|&nbsp;4h 45m\n                                                                                                                                                                                        &nbsp;|&nbsp;<span class=\"mildwarn\">60% on time </span>                                                                                                                                        &nbsp;|&nbsp;2134 miles\n                                                                                                                                        &nbsp;|&nbsp;<span class=\"qImg wifi\">WiFi Available</span>\n                                                                                                                                        &nbsp;|&nbsp;7 seats remain                                                                                    </div>\n                                        \n                                                                            </td>\n                                </tr>\n                                \n                                                                    <tr class=\"layover\">\n                                        <td>&nbsp;</td>\n                                        \n                                        <td class=\"direction\">Layover</td>\n                                        \n                                        <td colspan=\"3\">&nbsp;</td>\n                                        \n                                        <td class=\"duration\">\n                                            <div>2h 16m</div>\n                                        </td>\n                                    </tr>\n                                                                                                                                                                                            \n                                <tr class=\"first\">\n                                                                        \n                                    <td class=\"icon\">\n                                                                                    <img src='/images/v375101/air/FL.gif' />\n                                                                            </td>\n            \n                                    <td colspan=\"4\">\n                                        AirTran &mdash;\n                                                                                    Flight 140                                                    \n                                                                            </td>\n                                    \n                                    <td class=\"duration\">\n                                        1h 59m\n                                    </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Take-off</td>\n                                    \n                                    <td class=\"time\">Fri 9:00a</td>\n                                    \n                                    <td class=\"airportCode\">ATL</td>\n                                    \n                                    <td colspan=\"2\">Hartsfield-Jackson </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"direction\">Landing</td>\n                                    \n                                    <td class=\"time\">Fri 10:59a</td>\n                                    \n                                    <td class=\"airportCode\">DTW</td>\n                                    \n                                    <td colspan=\"2\">Detroit Metro </td>\n                                </tr>\n                                \n                                <tr>\n                                    <td>&nbsp;</td>\n                                    \n                                    <td class=\"extra\" colspan=\"5\">\n                                                                                \n                                                                                \n                                        <div>\n                                                                                            Coach\n                                                                                                    &nbsp;|&nbsp;Fare code: H7ZXC\n                                                                                                &nbsp;|&nbsp;\n                                                                                                                                        Boeing 717 (Narrow-body Jet)\n                                                                                                                                        &nbsp;|&nbsp;1h 59m\n                                                                                                                                                                                        &nbsp;|&nbsp;<span class=\"mildwarn\">70% on time </span>                                                                                                                                        &nbsp;|&nbsp;595 miles\n                                                                                                                                        &nbsp;|&nbsp;<span class=\"qImg wifi\">WiFi Available</span>\n                                                                                                                                        &nbsp;|&nbsp;7 seats remain                                                                                    </div>\n                                        \n                                                                            </td>\n                                </tr>\n                                \n                                                                                    </tbody>\n                    </table>\n                </div>\n                    </div>\n    \n        </div>";
